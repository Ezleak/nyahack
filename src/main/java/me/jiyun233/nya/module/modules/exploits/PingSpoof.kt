package me.jiyun233.nya.module.modules.exploits

import me.jiyun233.nya.event.events.client.PacketEvent
import me.jiyun233.nya.module.Category
import me.jiyun233.nya.module.Module
import me.jiyun233.nya.module.ModuleInfo
import net.minecraft.network.play.client.CPacketKeepAlive
import net.minecraft.network.play.server.SPacketKeepAlive
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent
import java.util.*

@ModuleInfo(name = "PingSpoof", category = Category.EXPLOITS, descriptions = "Spoof your server ping higher.")
object PingSpoof : Module() {
    private val delay = registerSetting("Delay", 200, 0, 114514)

    @SubscribeEvent
    fun onPacketReceive(event: PacketEvent.Receive) {
        if (fullNullCheck()) return

        if (event.packet !is SPacketKeepAlive) return

        event.isCanceled = true
        Timer().schedule(object : TimerTask() {
            override fun run() {
                mc.connection?.sendPacket(CPacketKeepAlive(event.packet.id))
            }
        }, delay.value.toLong())
    }

}